<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Traffic Monitoring System</title>
        <link rel="stylesheet" href="styles.css" />
        <link
            rel="shortcut icon"
            type="x-icon"
            sizes="16x16 32x32 64x64"
            href="../assets/images/icon_browser_image-removebg-preview.png"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhaijaan+2:wght@400..800&family=Beiruti:wght@200..900&family=Cairo:wght@200..1000&family=Changa:wght@200..800&family=Donegal+One&family=El+Messiri:wght@400..700&family=Exo+2:ital,wght@0,100..900;1,100..900&family=Freeman&family=Goblin+One&family=Metal+Mania&family=Readex+Pro:wght@160..700&family=Rubik:ital,wght@0,300..900;1,300..900&family=Suez+One&family=Tajawal:wght@200;300;400;500;700;800;900&family=Zain:wght@200;300;400;700;800;900&display=swap" rel="stylesheet">
        <style>
            /* ÿ£ŸÜŸÖÿßÿ∑ ÿπÿßŸÖÿ© */
            body {
                font-family: "Zain", serif;
                font-weight: 700;
                font-style: normal;
                direction: rtl;
                margin: 0;
                padding: 0;
                min-height: 100vh;
            }

            /* ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ≠ÿßŸàŸäÿ© */
            .container {
                width: 100%;
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #f0f0f0;
                position: relative;
                overflow: hidden;
            }

            .svg-container {
                width: 100%;
                height: 100%;
                max-width: 1200px;
                max-height: 800px;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            svg {
                width: 100%;
                height: 100%;
                max-height: 80vh;
            }

            /* ÿ£ŸÜŸÖÿßÿ∑ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ */
            .control-panel {
                position: fixed;
                top: -100%;
                left: 0;
                right: 0;
                background: white;
                padding: 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                transition: top 0.3s ease-in-out;
                z-index: 1000;
                max-height: 80vh;
                overflow-y: auto;
            }

            .control-panel.show {
                top: 0;
            }

            .panel-header {
                display: flex;
                justify-content: flex-end;
                margin-bottom: 20px;
                padding: 10px 20px;
                text-align: left;
            }

            .toggle-panel-container {
                position: fixed;
                top: 20px;
                left: 0;
                right: 0;
                display: flex;
                justify-content: center;
                padding: 0 20px;
                z-index: 1000;
            }

            .toggle-panel {
                background-color: #1b5c76;
                color: white;
                border: none;
                border-radius: 5px;
                padding: 10px 20px;
                cursor: pointer;
                font-size: 16px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                transition: background-color 0.3s;
                width: calc(100% - 40px);
                text-align: center;
                font-family: "Zain", serif;
                font-weight: 700;
                font-style: normal;
            }

            .toggle-panel:hover {
                background-color: #0d5470;
            }

            @media (min-width: 768px) {
                .toggle-panel {
                    width: auto;
                    min-width: 1000px;
                    margin-right: calc(50% - 515px);
                }
            }

            @media (max-width: 480px) {
                .toggle-panel-container {
                    padding: 0 10px;
                }

                svg {
                    transform: scale(1.5);
                }
            }

            @media (min-width: 480px) and (max-width: 1024px) {
                svg {
                    transform: scale(1.5);
                }
            }

            @media (min-width: 480px) and (max-width: 1024px) {
                .toggle-panel {
                    width: auto;
                    min-width: 500px;
                    margin-right: calc(50% - 275px);
                    margin-top: calc(100vh - 100px);
                }
            }


            .panel-header button {
                padding: 8px 15px;
                background-color: #e74c3c;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

            .close_btn {
                padding: 8px 20px;
                background-color: #f44336;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                width: 100%;
                font-family: "Zain", serif;
                font-weight: 700;
                font-style: normal;
            }

            .close_btn:hover {
                background-color: #d32f2f;
            }

            .desktop-close, .mobile-close {
                display: none;
            }

            .panel-footer {
                padding: 20px;
                margin-top: 20px;
                border-top: 1px solid #eee;
            }

            /* ÿ™ŸÜÿ≥ŸäŸÇ ŸÇÿ≥ŸÖ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ */
            .stats-section {
                background: #fff;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .stats-section h3 {
                color: #3498db;
                margin-bottom: 15px;
                font-size: 18px;
                border-bottom: 2px solid rgba(52, 152, 219, 0.2);
                padding-bottom: 10px;
            }

            .stats-panel {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin-bottom: 20px;
            }

            .stat-card {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                transition: all 0.3s ease;
                border: 1px solid #eee;
            }

            .stat-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            }

            .stat-card h4 {
                margin: 0;
                color: #7f8c8d;
                font-size: 14px;
                margin-bottom: 10px;
            }

            .stat-value {
                font-size: 24px;
                font-weight: bold;
                color: #2c3e50;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .stat-icon {
                width: 40px;
                height: 40px;
                background: #3498db;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 20px;
            }

            .stat-trend {
                font-size: 14px;
                color: #27ae60;
                display: flex;
                align-items: center;
                gap: 5px;
                margin-top: 5px;
            }

            .trend-down {
                color: #e74c3c;
            }

            /* ÿ™ŸÜÿ≥ŸäŸÇ ŸÇÿ≥ŸÖ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ */
            .congestion-section {
                background: #fff;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .congestion-section h3 {
                color: #2ecc71;
                margin-bottom: 15px;
                font-size: 18px;
                border-bottom: 2px solid rgba(46, 204, 113, 0.2);
                padding-bottom: 10px;
            }

            .congestion-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .congestion-card {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                gap: 15px;
                border: 1px solid #eee;
                transition: all 0.3s ease;
            }

            .congestion-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            }

            .direction-icon {
                width: 40px;
                height: 40px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 20px;
            }

            .direction-north { background: #3498db; }
            .direction-south { background: #e74c3c; }
            .direction-east { background: #f1c40f; }
            .direction-west { background: #9b59b6; }

            .congestion-info {
                flex: 1;
            }

            .direction-name {
                font-size: 16px;
                font-weight: bold;
                color: #2c3e50;
                margin-bottom: 5px;
            }

            .congestion-status {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .status-indicator {
                width: 10px;
                height: 10px;
                border-radius: 50%;
            }

            .level-low { 
                background: #2ecc71;
                box-shadow: 0 0 8px rgba(46, 204, 113, 0.4);
            }
            
            .level-medium { 
                background: #f1c40f;
                box-shadow: 0 0 8px rgba(241, 196, 15, 0.4);
            }
            
            .level-high { 
                background: #e74c3c;
                box-shadow: 0 0 8px rgba(231, 76, 60, 0.4);
            }

            .status-text {
                font-size: 14px;
                color: #7f8c8d;
            }

            .car-count {
                font-size: 14px;
                color: #95a5a6;
                margin-top: 5px;
            }

            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }

            .level-high {
                animation: pulse 2s infinite;
            }

            /* ŸÇÿ≥ŸÖ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ */
            .emergency-section {
                background: #fff;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .emergency-section h3 {
                color: #e74c3c;
                margin-bottom: 15px;
                font-size: 18px;
                border-bottom: 2px solid rgba(231, 76, 60, 0.2);
                padding-bottom: 10px;
            }

            .emergency-controls {
                background: #fff3f3;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
            }

            .emergency-options {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin-bottom: 20px;
                font-family: "Zain", serif;
                font-weight: 700;
                font-style: normal;
            }

            .emergency-select {
                padding: 10px;
                border: 2px solid #ddd;
                border-radius: 6px;
                font-size: 14px;
                color: #2c3e50;
                background: white;
                cursor: pointer;
                transition: all 0.3s ease;
                width: 100%;
                font-family: "Zain", serif;
                font-weight: 700;
                font-style: normal;
            }

            .emergency-select:hover {
                border-color: #e74c3c;
            }

            .emergency-select:focus {
                outline: none;
                border-color: #e74c3c;
                box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
            }

            .emergency-button {
                background: #e74c3c;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-weight: bold;
                width: 100%;
                font-size: 16px;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                font-family: "Zain", serif;
                font-weight: 700;
                font-style: normal;
            }

            .emergency-button:hover {
                background: #c0392b;
                transform: translateY(-1px);
            }

            .emergency-button:active {
                transform: translateY(1px);
            }

            .emergency-button i {
                font-size: 20px;
            }

            .emergency-status {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 6px;
                margin-top: 15px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .status-text {
                color: #2c3e50;
                font-weight: bold;
            }

            .status-indicator {
                width: 12px;
                height: 12px;
                border-radius: 50%;
            }

            .status-active {
                background: #e74c3c;
                animation: blink 1s infinite;
            }

            /* ÿ≤ÿ± ÿßŸÑÿ™ÿ®ÿØŸäŸÑ */
            @media (max-width: 768px) {
                .stats-panel {
                    grid-template-columns: 1fr 1fr;
                }

                .control-panel {
                    max-height: 70vh;
                }

                .panel-footer {
                    margin-top: auto;
                    padding: 15px;
                }

                .close_btn {
                    font-size: 16px;
                    padding: 10px;
                }

                .congestion-grid {
                    grid-template-columns: repeat(1, 1fr);
                }
            }

            @media (max-width: 480px) {
                .stats-panel {
                    grid-template-columns: 1fr;
                }
            }

            /* Emergency Alert Styles */
            .emergency-alert {
                position: fixed;
                top: -100px;
                left: 50%;
                transform: translateX(-50%);
                background-color: #e74c3c;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                transition: top 0.5s ease-in-out;
            }

            .alert-content {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .emergency-icon {
                font-size: 24px;
            }

            .emergency-text {
                font-size: 16px;
                font-weight: bold;
            }

            .progress-bar {
                width: 200px;
                height: 6px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 3px;
                overflow: hidden;
            }

            .progress {
                height: 100%;
                background: white;
                transition: width 0.3s ease-in-out;
            }

            @keyframes blink {
                0% { opacity: 1; }
                50% { opacity: 0.5; }
                100% { opacity: 1; }
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± */
            .control-panel::-webkit-scrollbar {
                width: 8px;
            }

            .control-panel::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 4px;
            }

            .control-panel::-webkit-scrollbar-thumb {
                background: #c0392b;
                border-radius: 4px;
            }

            .control-panel::-webkit-scrollbar-thumb:hover {
                background: #e74c3c;
            }

            /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .control-panel {
                animation: fadeIn 0.5s ease-out;
            }
        </style>
    </head>
    <body style="margin: 0; padding: 0; overflow: hidden">
        <div class="toggle-panel-container">
            <button class="toggle-panel" onclick="togglePanel()">
                ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
            </button>
        </div>

        <div class="control-panel">
            <div class="stats-section">
                <h3>ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ±</h3>
                <div class="stats-panel">
                    <div class="stat-card">
                        <h4>ŸÖÿ™Ÿàÿ≥ÿ∑ ŸàŸÇÿ™ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±:</h4>
                        <div class="stat-value" id="avgWaitTime">45s</div>
                    </div>
                    <div class="stat-card">
                        <h4>ÿπÿØÿØ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™:</h4>
                        <div class="stat-value" id="carCount">127</div>
                    </div>
                    <div class="stat-card">
                        <h4>ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ:</h4>
                        <div class="stat-value" id="congestionLevel">ŸÖÿ™Ÿàÿ≥ÿ∑</div>
                    </div>
                    <div class="stat-card">
                        <h4>ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿßŸÑŸÜÿ¥ÿ∑ÿ©:</h4>
                        <div class="stat-value" id="emergencyCount">0</div>
                    </div>
                </div>
            </div>

            <div class="congestion-section">
                <h3>ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ</h3>
                <div class="congestion-grid">
                    <div class="congestion-card">
                        <div class="direction-icon direction-north">‚¨ÜÔ∏è</div>
                        <div class="congestion-info">
                            <div class="direction-name">ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ¥ŸÖÿßŸÑŸä</div>
                            <div class="congestion-status">
                                <div class="status-indicator level-low"></div>
                                <div class="status-text" id="north-status">ŸÖŸÜÿÆŸÅÿ∂</div>
                            </div>
                            <div class="car-count" id="north-congestion">25 ÿ≥Ÿäÿßÿ±ÿ©</div>
                        </div>
                    </div>
                    <div class="congestion-card">
                        <div class="direction-icon direction-south">‚¨áÔ∏è</div>
                        <div class="congestion-info">
                            <div class="direction-name">ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ¨ŸÜŸàÿ®Ÿä</div>
                            <div class="congestion-status">
                                <div class="status-indicator level-medium"></div>
                                <div class="status-text" id="south-status">ŸÖÿ™Ÿàÿ≥ÿ∑</div>
                            </div>
                            <div class="car-count" id="south-congestion">35 ÿ≥Ÿäÿßÿ±ÿ©</div>
                        </div>
                    </div>
                    <div class="congestion-card">
                        <div class="direction-icon direction-east">‚û°Ô∏è</div>
                        <div class="congestion-info">
                            <div class="direction-name">ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ¥ÿ±ŸÇŸä</div>
                            <div class="congestion-status">
                                <div class="status-indicator level-high"></div>
                                <div class="status-text" id="east-status">ŸÖÿ±ÿ™ŸÅÿπ</div>
                            </div>
                            <div class="car-count" id="east-congestion">42 ÿ≥Ÿäÿßÿ±ÿ©</div>
                        </div>
                    </div>
                    <div class="congestion-card">
                        <div class="direction-icon direction-west">‚¨ÖÔ∏è</div>
                        <div class="congestion-info">
                            <div class="direction-name">ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ∫ÿ±ÿ®Ÿä</div>
                            <div class="congestion-status">
                                <div class="status-indicator level-low"></div>
                                <div class="status-text" id="west-status">ŸÖŸÜÿÆŸÅÿ∂</div>
                            </div>
                            <div class="car-count" id="west-congestion">25 ÿ≥Ÿäÿßÿ±ÿ©</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="emergency-section">
                <h3>ÿ•ÿØÿßÿ±ÿ© ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶</h3>
                <div class="emergency-controls">
                    <div class="emergency-options">
                        <select id="emergencyType" class="emergency-select">
                            <option value="" disabled selected>ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶</option>
                            <option value="ambulance">ÿ≥Ÿäÿßÿ±ÿ© ÿ•ÿ≥ÿπÿßŸÅ</option>
                            <option value="police">ÿ¥ÿ±ÿ∑ÿ©</option>
                            <option value="fire">ÿ≠ÿ±ŸäŸÇ</option>
                            <option value="accident">ÿ≠ÿßÿØÿ´</option>
                            <option value="danger_material">ŸÖŸàÿßÿØ ÿÆÿ∑ÿ±ÿ©</option>
                        </select>
                        <select id="emergencyDirection" class="emergency-select">
                            <option value="" disabled selected>ÿßÿÆÿ™ÿ± ÿßŸÑÿßÿ™ÿ¨ÿßŸá</option>
                            <option value="north">ÿ¥ŸÖÿßŸÑ</option>
                            <option value="south">ÿ¨ŸÜŸàÿ®</option>
                            <option value="east">ÿ¥ÿ±ŸÇ</option>
                            <option value="west">ÿ∫ÿ±ÿ®</option>
                        </select>
                    </div>
                    <button class="emergency-button" onclick="activateEmergency()">
                        ÿ™ŸÅÿπŸäŸÑ ÿ≠ÿßŸÑÿ© ÿ∑Ÿàÿßÿ±ÿ¶
                    </button>
                </div>
            </div>

            <div class="panel-footer">
                <button class="close_btn" onclick="togglePanel()">ÿßÿ∫ŸÑÿßŸÇ</button>
            </div>
        </div>

        <div class="container">
            <div class="svg-container">
                <svg
                    width="100%"
                    height="100%"
                    viewBox="0 0 1200 800"
                    preserveAspectRatio="xMidYMid meet"
                >
                    <defs>
                        <!-- ÿ≥Ÿäÿßÿ±ÿ© ŸÖÿ™ÿ¨Ÿáÿ© ŸÑŸÑÿ¥ŸÖÿßŸÑ/ÿßŸÑÿ¨ŸÜŸàÿ® -->
                        <symbol id="car-vertical">
                            <rect
                                x="0"
                                y="0"
                                width="40"
                                height="60"
                                fill="currentColor"
                            />
                            <rect
                                x="5"
                                y="5"
                                width="30"
                                height="15"
                                fill="#333"
                            />
                            <rect
                                x="5"
                                y="40"
                                width="30"
                                height="15"
                                fill="#333"
                            />
                            <rect
                                x="2"
                                y="20"
                                width="36"
                                height="20"
                                fill="#666"
                            />
                            <circle cx="10" cy="50" r="3" fill="#111" />
                            <circle cx="30" cy="50" r="3" fill="#111" />
                            <circle cx="10" cy="10" r="3" fill="#111" />
                            <circle cx="30" cy="10" r="3" fill="#111" />
                        </symbol>
                        <!-- ÿ≥Ÿäÿßÿ±ÿ© ŸÖÿ™ÿ¨Ÿáÿ© ŸÑŸÑÿ¥ÿ±ŸÇ/ÿßŸÑÿ∫ÿ±ÿ® -->
                        <symbol id="car-horizontal">
                            <rect
                                x="0"
                                y="0"
                                width="60"
                                height="40"
                                fill="currentColor"
                            />
                            <rect
                                x="5"
                                y="5"
                                width="15"
                                height="30"
                                fill="#333"
                            />
                            <rect
                                x="40"
                                y="5"
                                width="15"
                                height="30"
                                fill="#333"
                            />
                            <rect
                                x="20"
                                y="2"
                                width="20"
                                height="36"
                                fill="#666"
                            />
                            <circle cx="10" cy="10" r="3" fill="#111" />
                            <circle cx="10" cy="30" r="3" fill="#111" />
                            <circle cx="50" cy="10" r="3" fill="#111" />
                            <circle cx="50" cy="30" r="3" fill="#111" />
                        </symbol>
                    </defs>
                    <!-- ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ£ŸÅŸÇŸä -->
                    <g id="horizontal-road">
                        <!-- ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ£Ÿäÿ≥ÿ± -->
                        <rect
                            id="horizontal-road-left"
                            x="200"
                            y="300"
                            width="280"
                            height="200"
                            fill="#666"
                            stroke="#666"
                            stroke-width="2"
                        />

                        <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ™ŸÇÿßÿ∑ÿπ -->
                        <rect
                            id="intersection"
                            x="480"
                            y="300"
                            width="240"
                            height="200"
                            fill="#666"
                            stroke="#666"
                            stroke-width="2"
                        />

                        <!-- ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ£ŸäŸÖŸÜ -->
                        <rect
                            id="horizontal-road-right"
                            x="720"
                            y="300"
                            width="280"
                            height="200"
                            fill="#666"
                            stroke="#666"
                            stroke-width="2"
                        />
                    </g>

                    <!-- ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ±ÿ£ÿ≥Ÿä -->
                    <g id="vertical-road">
                        <!-- ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿπŸÑŸàŸä -->
                        <rect
                            id="vertical-road-top"
                            x="480"
                            y="0"
                            width="240"
                            height="300"
                            fill="#666"
                            stroke="#666"
                            stroke-width="2"
                        />

                        <!-- ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ≥ŸÅŸÑŸä -->
                        <rect
                            id="vertical-road-bottom"
                            x="480"
                            y="500"
                            width="240"
                            height="300"
                            fill="#666"
                            stroke="#666"
                            stroke-width="2"
                        />
                    </g>

                    <!-- ÿÆÿ∑Ÿàÿ∑ ÿßŸÑÿ∑ÿ±ŸäŸÇ -->
                    <line
                        x1="200"
                        y1="400"
                        x2="1000"
                        y2="400"
                        stroke="white"
                        stroke-width="4"
                        stroke-dasharray="40,40"
                    />
                    <line
                        x1="600"
                        y1="100"
                        x2="600"
                        y2="700"
                        stroke="white"
                        stroke-width="4"
                        stroke-dasharray="40,40"
                    />

                    <!-- ÿ•ÿ¥ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ± -->
                    <g id="traffic-lights">
                        <!-- ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¥ŸÖÿßŸÑŸäÿ© -->
                        <g id="north-light" transform="translate(600, 120)">
                            <rect
                                x="-25"
                                y="-10"
                                width="50"
                                height="120"
                                fill="#333"
                                rx="10"
                            />
                            <rect
                                x="-20"
                                y="-5"
                                width="40"
                                height="110"
                                fill="#222"
                                rx="8"
                            />
                            <circle
                                id="north-red"
                                cx="0"
                                cy="15"
                                r="12"
                                fill="red"
                            />
                            <circle
                                id="north-yellow"
                                cx="0"
                                cy="50"
                                r="12"
                                fill="#333"
                            />
                            <circle
                                id="north-green"
                                cx="0"
                                cy="85"
                                r="12"
                                fill="#333"
                            />
                        </g>

                        <!-- ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ŸÜŸàÿ®Ÿäÿ© -->
                        <g id="south-light" transform="translate(600, 580)">
                            <rect
                                x="-25"
                                y="-10"
                                width="50"
                                height="120"
                                fill="#333"
                                rx="10"
                            />
                            <rect
                                x="-20"
                                y="-5"
                                width="40"
                                height="110"
                                fill="#222"
                                rx="8"
                            />
                            <circle
                                id="south-red"
                                cx="0"
                                cy="15"
                                r="12"
                                fill="red"
                            />
                            <circle
                                id="south-yellow"
                                cx="0"
                                cy="50"
                                r="12"
                                fill="#333"
                            />
                            <circle
                                id="south-green"
                                cx="0"
                                cy="85"
                                r="12"
                                fill="#333"
                            />
                        </g>

                        <!-- ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¥ÿ±ŸÇŸäÿ© -->
                        <g id="east-light" transform="translate(780, 400)">
                            <rect
                                x="-10"
                                y="-25"
                                width="120"
                                height="50"
                                fill="#333"
                                rx="10"
                            />
                            <rect
                                x="-5"
                                y="-20"
                                width="110"
                                height="40"
                                fill="#222"
                                rx="8"
                            />
                            <circle
                                id="east-red"
                                cx="15"
                                cy="0"
                                r="12"
                                fill="red"
                            />
                            <circle
                                id="east-yellow"
                                cx="50"
                                cy="0"
                                r="12"
                                fill="#333"
                            />
                            <circle
                                id="east-green"
                                cx="85"
                                cy="0"
                                r="12"
                                fill="#333"
                            />
                        </g>

                        <!-- ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ© -->
                        <g id="west-light" transform="translate(420, 400)">
                            <rect
                                x="-110"
                                y="-25"
                                width="120"
                                height="50"
                                fill="#333"
                                rx="10"
                            />
                            <rect
                                x="-105"
                                y="-20"
                                width="110"
                                height="40"
                                fill="#222"
                                rx="8"
                            />
                            <circle
                                id="west-red"
                                cx="-85"
                                cy="0"
                                r="12"
                                fill="red"
                            />
                            <circle
                                id="west-yellow"
                                cx="-50"
                                cy="0"
                                r="12"
                                fill="#333"
                            />
                            <circle
                                id="west-green"
                                cx="-15"
                                cy="0"
                                r="12"
                                fill="#333"
                            />
                        </g>
                    </g>
                </svg>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            let isAutomatic = false;
            let automaticInterval;
            let emergencyMode = false;
            let congestionLevels = {
                north: 'low',
                south: 'medium',
                east: 'high',
                west: 'low'
            };

            let emergencyStats = {
                active: false,
                type: null, // 'ambulance', 'police', 'fire'
                direction: null,
                startTime: null,
                duration: 20, // seconds
                affectedRoads: [],
                vehiclePosition: 0, // 0-100 progress
                clearanceZone: 20 // percentage of road to clear
            };

            let trafficStats = {
                emergencyCount: parseInt(localStorage.getItem('emergencyCount')) || 0,
                waitTime: 45,
                carCount: 127,
                roads: {
                    north: { cars: 25, capacity: 50 },
                    south: { cars: 35, capacity: 50 },
                    east: { cars: 42, capacity: 50 },
                    west: { cars: 25, capacity: 50 }
                }
            };

            function getEmergencyIcon(type) {
                switch(type) {
                    case 'ambulance': return 'üöë';
                    case 'police': return 'üöì';
                    case 'fire': return 'üöí';
                    case 'accident': return 'üöóüí•';
                    case 'danger_material': return '‚ò¢Ô∏è';
                    default: return 'üö®';
                }
            }

            function activateEmergency() {
                const type = document.getElementById('emergencyType').value;
                const direction = document.getElementById('emergencyDirection').value;
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ŸàÿßŸÑÿßÿ™ÿ¨ÿßŸá
                if (!type || type === 'ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶') {
                    Swal.fire({
                        title: 'ÿ™ŸÜÿ®ŸäŸá',
                        text: 'ŸÖŸÜ ŸÅÿ∂ŸÑŸÉ ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶',
                        icon: 'warning',
                        confirmButtonText: 'ÿ≠ÿ≥ŸÜÿßŸã',
                        confirmButtonColor: '#3085d6'
                    });
                    return;
                }

                if (!direction || direction === 'ÿßÿÆÿ™ÿ± ÿßŸÑÿßÿ™ÿ¨ÿßŸá') {
                    Swal.fire({
                        title: 'ÿ™ŸÜÿ®ŸäŸá',
                        text: 'ŸÖŸÜ ŸÅÿ∂ŸÑŸÉ ÿßÿÆÿ™ÿ± ÿßÿ™ÿ¨ÿßŸá ŸÖÿ±ŸÉÿ®ÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶',
                        icon: 'warning',
                        confirmButtonText: 'ÿ≠ÿ≥ŸÜÿßŸã',
                        confirmButtonColor: '#3085d6'
                    });
                    return;
                }
                
                if (!emergencyStats.active) {
                    emergencyStats.active = true;
                    emergencyStats.type = type;
                    emergencyStats.direction = direction;
                    emergencyStats.startTime = new Date();
                    emergencyStats.vehiclePosition = 0;
                    emergencyMode = true;
                    trafficStats.emergencyCount++;
                    localStorage.setItem('emergencyCount', trafficStats.emergencyCount.toString());            
                    // ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ∑ÿ±ŸÇ ÿßŸÑŸÖÿ™ÿ£ÿ´ÿ±ÿ©
                    determineAffectedRoads(direction);
                    
                    // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ•ŸÜÿ∞ÿßÿ±
                    activateEmergencyAlert(type, direction);
                    
                    // ÿ®ÿØÿ° ŸÖÿ≠ÿßŸÉÿßÿ© ÿ≠ÿ±ŸÉÿ© ŸÖÿ±ŸÉÿ®ÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶
                    startEmergencySimulation();
                    
                    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©
                    speakEmergencyMessage(type);
                }
            }

            function determineAffectedRoads(primaryDirection) {
                emergencyStats.affectedRoads = [];
                const oppositeDirections = {
                    'north': 'south',
                    'south': 'north',
                    'east': 'west',
                    'west': 'east'
                };
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßÿ™ÿ¨ÿßŸá ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸàÿßŸÑŸÖÿπÿßŸÉÿ≥ ŸÑŸá
                emergencyStats.affectedRoads.push(primaryDirection);
                emergencyStats.affectedRoads.push(oppositeDirections[primaryDirection]);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ¥ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ± ŸÑŸÑÿ∑ÿ±ŸÇ ÿßŸÑŸÖÿ™ÿ£ÿ´ÿ±ÿ©
                updateTrafficLightsForEmergency();
            }

            function updateTrafficLightsForEmergency() {
                const directions = ['north', 'south', 'east', 'west'];
                directions.forEach(dir => {
                    const isAffected = emergencyStats.affectedRoads.includes(dir);
                    const isMainDirection = dir === emergencyStats.direction;
                    
                    const redLight = document.getElementById(`${dir}-red`);
                    const yellowLight = document.getElementById(`${dir}-yellow`);
                    const greenLight = document.getElementById(`${dir}-green`);
                    
                    if (redLight && yellowLight && greenLight) {
                        // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ£ŸàŸÑÿßŸã
                        redLight.style.fill = '#333';
                        yellowLight.style.fill = '#333';
                        greenLight.style.fill = '#333';
                        
                        // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸàŸÖŸäÿ∂ ÿ≥ÿßÿ®ŸÇÿ©
                        redLight.style.animation = '';
                        yellowLight.style.animation = '';
                        greenLight.style.animation = '';

                        if (isMainDirection) {
                            // ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸÑŸÑÿ∑Ÿàÿßÿ±ÿ¶ - ÿ£ÿÆÿ∂ÿ±
                            if (emergencyStats.type === 'fire' || emergencyStats.type === 'accident') {
                                redLight.style.fill = 'red';
                                redLight.style.animation = 'blink 1s infinite';
                            } else {
                                greenLight.style.fill = 'green';
                                greenLight.style.animation = 'blink 1s infinite';
                            }
                        } else if (isAffected) {
                            // ÿßŸÑÿ∑ÿ±ŸÇ ÿßŸÑŸÖÿ™ÿ£ÿ´ÿ±ÿ© - ÿ£ÿ≠ŸÖÿ±
                            redLight.style.fill = 'red';
                        }
                    }
                });
            }

            function activateEmergencyAlert(type, direction) {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'emergency-alert';
                alertDiv.innerHTML = `
                    <div class="alert-content">
                        <span class="emergency-icon">${getEmergencyIcon(type)}</span>
                        <span class="emergency-text">
                            ÿ≠ÿßŸÑÿ© ÿ∑Ÿàÿßÿ±ÿ¶: ${type === 'ambulance' ? 'ÿ•ÿ≥ÿπÿßŸÅ' : type === 'police' ? 'ÿ¥ÿ±ÿ∑ÿ©' : type === 'fire' ? 'ÿ≠ÿ±ŸäŸÇ' : type === 'accident' ? 'ÿ≠ÿßÿØÿ´' : 'ŸÖŸàÿßÿØ ÿÆÿ∑ÿ±ÿ©'}
                            ŸÅŸä ÿßŸÑÿßÿ™ÿ¨ÿßŸá ${
                                direction === 'north' ? 'ÿßŸÑÿ¥ŸÖÿßŸÑŸä' : 
                                direction === 'south' ? 'ÿßŸÑÿ¨ŸÜŸàÿ®Ÿä' : 
                                direction === 'east' ? 'ÿßŸÑÿ¥ÿ±ŸÇŸä' : 'ÿßŸÑÿ∫ÿ±ÿ®Ÿä'
                            }
                        </span>
                        <div class="progress-bar">
                            <div class="progress" style="width: 0%"></div>
                        </div>
                    </div>
                `;
                document.body.appendChild(alertDiv);
                
                // ÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑÿ•ŸÜÿ∞ÿßÿ± ŸÖŸÜ ÿ£ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                setTimeout(() => alertDiv.style.top = '20px', 100);
            }

            function startEmergencySimulation() {
                const updateInterval = 200; // ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑ 200 ŸÖŸÑŸÑŸä ÿ´ÿßŸÜŸäÿ© ŸÑŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑÿ≥ŸÑÿ≥ÿ©
                const progressInterval = setInterval(() => {
                    if (emergencyStats.active) {
                        // ÿ≤ŸäÿßÿØÿ© ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ™ŸÇÿØŸÖ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÖÿØÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
                        emergencyStats.vehiclePosition += (100 * updateInterval) / (emergencyStats.duration * 1000);
                        
                        // ÿ™ÿ≠ÿØŸäÿ´ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
                        const progressBar = document.querySelector('.emergency-alert .progress');
                        if (progressBar) {
                            progressBar.style.width = `${Math.min(100, emergencyStats.vehiclePosition)}%`;
                        }
                        
                        // ÿ•ÿÆŸÑÿßÿ° ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿ≠ŸàŸÑ ŸÖÿ±ŸÉÿ®ÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶
                        clearEmergencyZone();
                        
                        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑŸÖŸáŸÖÿ©
                        if (emergencyStats.vehiclePosition >= 100) {
                            deactivateEmergency();
                            clearInterval(progressInterval);
                        }
                    }
                }, updateInterval);
            }

            function clearEmergencyZone() {
                const mainRoad = trafficStats.roads[emergencyStats.direction];
                if (mainRoad) {
                    // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ™Ÿä Ÿäÿ¨ÿ® ÿ•ÿÆŸÑÿßÿ§Ÿáÿß
                    const zoneStart = Math.max(0, emergencyStats.vehiclePosition - emergencyStats.clearanceZone/2);
                    const zoneEnd = Math.min(100, emergencyStats.vehiclePosition + emergencyStats.clearanceZone/2);
                    
                    // ÿ™ŸÇŸÑŸäŸÑ ÿπÿØÿØ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™ ŸÅŸä ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©
                    const clearedCars = Math.floor(mainRoad.cars * (emergencyStats.clearanceZone/100));
                    mainRoad.cars = Math.max(0, mainRoad.cars - clearedCars);
                }
            }

            function deactivateEmergency() {
                emergencyStats.active = false;
                emergencyMode = false;
                
                // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©
                stopSpeaking();
                
                // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ•ŸÜÿ∞ÿßÿ± ÿ®ÿ¥ŸÉŸÑ ŸÖÿ™ÿ≠ÿ±ŸÉ
                const alertDiv = document.querySelector('.emergency-alert');
                if (alertDiv) {
                    alertDiv.style.top = '-100px';
                    setTimeout(() => alertDiv.remove(), 500);
                }
                
                // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ•ÿ¥ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ±
                const directions = ['north', 'south', 'east', 'west'];
                directions.forEach(dir => {
                    const lights = ['red', 'yellow', 'green'].map(color => 
                        document.getElementById(`${dir}-${color}`)
                    );
                    lights.forEach(light => {
                        if (light) light.style.animation = '';
                    });
                    updateTrafficLightByLevel(dir, congestionLevels[dir]);
                });
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
                updateStats();
            }

            function updateCongestion() {
                for (const direction in congestionLevels) {
                    const element = document.getElementById(`${direction}-congestion`);
                    if (element) {
                        // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿπÿØÿØ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™
                        const roadStats = trafficStats.roads[direction];
                        const congestionPercentage = (roadStats.cars / roadStats.capacity) * 100;
                        
                        let text = 'ŸÖŸÜÿÆŸÅÿ∂';
                        let levelClass = 'level-low';
                        let trafficLevel = 'low';
                        
                        if (congestionPercentage >= 80) {
                            text = 'ŸÖÿ±ÿ™ŸÅÿπ';
                            levelClass = 'level-high';
                            trafficLevel = 'high';
                        } else if (congestionPercentage >= 50) {
                            text = 'ŸÖÿ™Ÿàÿ≥ÿ∑';
                            levelClass = 'level-medium';
                            trafficLevel = 'medium';
                        } else {
                            congestionLevels[direction] = 'low';
                        }
                        
                        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµ ŸÑŸäÿ¥ŸÖŸÑ ÿπÿØÿØ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™
                        element.textContent = `${text} (${roadStats.cars} ÿ≥Ÿäÿßÿ±ÿ©)`;
                        const indicator = element.parentElement.querySelector('.congestion-level');
                        if (indicator) {
                            indicator.className = `congestion-level ${levelClass}`;
                        }

                        // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
                        updateTrafficLightByLevel(direction, trafficLevel);
                    }
                }
            }

            function updateTrafficLightByLevel(direction, level) {
                // ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿØÿßŸÑÿ© ŸÑŸÑÿ≥ŸÖÿßÿ≠ ÿ®ÿßŸÑÿπŸÖŸÑ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ŸÑŸÑÿ∑ÿ±ŸÇ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ™ÿ£ÿ´ÿ±ÿ©
                if (emergencyMode && (direction === emergencyStats.direction || emergencyStats.affectedRoads.includes(direction))) return;

                const redLight = document.getElementById(`${direction}-red`);
                const yellowLight = document.getElementById(`${direction}-yellow`);
                const greenLight = document.getElementById(`${direction}-green`);
                
                if (redLight && yellowLight && greenLight) {
                    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸÑŸàÿßŸÜ
                    redLight.style.fill = '#333';
                    yellowLight.style.fill = '#333';
                    greenLight.style.fill = '#333';
                    
                    // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸàŸÖŸäÿ∂
                    redLight.style.animation = '';
                    yellowLight.style.animation = '';
                    greenLight.style.animation = '';

                    // ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÑŸàŸÜ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ
                    switch (level) {
                        case 'low':
                            // ÿ£ÿÆÿ∂ÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑŸÖŸÜÿÆŸÅÿ∂
                            greenLight.style.fill = 'green';
                            break;
                        case 'medium':
                            // ÿ£ÿµŸÅÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑
                            yellowLight.style.fill = 'yellow';
                            break;
                        case 'high':
                            // ÿ£ÿ≠ŸÖÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑŸÖÿ±ÿ™ŸÅÿπ
                            redLight.style.fill = 'red';
                            break;
                    }
                }
            }

            function updateStats() {
                document.getElementById('avgWaitTime').textContent = `${trafficStats.waitTime}s`;
                document.getElementById('carCount').textContent = trafficStats.carCount;
                document.getElementById('emergencyCount').textContent = trafficStats.emergencyCount;
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑÿπÿßŸÖ
                let congestionText = 'ŸÖŸÜÿÆŸÅÿ∂';
                const highCongestionRoads = Object.values(trafficStats.roads)
                    .filter(road => (road.cars / road.capacity) >= 0.8).length;
                
                if (highCongestionRoads >= 2) {
                    congestionText = 'ŸÖÿ±ÿ™ŸÅÿπ';
                } else if (highCongestionRoads === 1) {
                    congestionText = 'ŸÖÿ™Ÿàÿ≥ÿ∑';
                }
                document.getElementById('congestionLevel').textContent = congestionText;
            }

            function resetTrafficLights() {
                const directions = ['north', 'south', 'east', 'west'];
                directions.forEach(dir => {
                    const redLight = document.getElementById(`${dir}-red`);
                    const yellowLight = document.getElementById(`${dir}-yellow`);
                    const greenLight = document.getElementById(`${dir}-green`);
                    
                    if (redLight && yellowLight && greenLight) {
                        redLight.style.fill = '#ff0000';
                        yellowLight.style.fill = '#333';
                        greenLight.style.fill = '#333';
                    }
                });
            }

            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÉŸÑ 5 ÿ´ŸàÿßŸÜŸä
            setInterval(() => {
                if (!emergencyMode) {
                    // ÿ™ÿ≠ÿØŸäÿ´ ŸàŸÇÿ™ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
                    trafficStats.waitTime += Math.floor(Math.random() * 5) - 2;
                    if (trafficStats.waitTime < 0) trafficStats.waitTime = 0;
                    
                    // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™ ŸÅŸä ŸÉŸÑ ÿ∑ÿ±ŸäŸÇ
                    updateRoadStats();
                    
                    updateStats();
                    updateCongestion();
                }
            }, 5000);

            function updateRoadStats() {
                if (!emergencyMode) {
                    // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™ ŸÅŸä ŸÉŸÑ ÿ∑ÿ±ŸäŸÇ
                    for (const direction in trafficStats.roads) {
                        const road = trafficStats.roads[direction];
                        
                        // ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿ•ÿ≤ÿßŸÑÿ© ÿ≥Ÿäÿßÿ±ÿßÿ™ ÿ®ÿ¥ŸÉŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿä
                        const change = Math.floor(Math.random() * 5) - 2;
                        road.cars += change;
                        
                        // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿπÿØÿØ ŸÅŸä ÿßŸÑŸÜÿ∑ÿßŸÇ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠
                        if (road.cars < 0) road.cars = 0;
                        if (road.cars > road.capacity) road.cars = road.capacity;
                    }

                    // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿπÿØÿØ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™
                    trafficStats.carCount = Object.values(trafficStats.roads)
                        .reduce((sum, road) => sum + road.cars, 0);
                }
            }

            // ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿ£ÿµŸàÿßÿ™ ŸÑŸÉŸÑ ŸÜŸàÿπ ÿ∑Ÿàÿßÿ±ÿ¶
            const emergencySounds = {
                'accident': new Audio('./assets/sounds/accident.mp3'),
                'ambulance': new Audio('./assets/sounds/ambulance.mp3'),
                'danger_material': new Audio('./assets/sounds/danger_material.mp3'),
                'fire': new Audio('./assets/sounds/fire.mp3'),
                'police': new Audio('./assets/sounds/police.mp3')
            };

            // ÿ™ŸáŸäÿ¶ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™
            Object.values(emergencySounds).forEach(sound => {
                sound.preload = 'auto';
                sound.volume = 0.7;
            });

            let audioInterval = null;
            let currentSound = null;

            function speakEmergencyMessage(type) {
                stopSpeaking(); // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ÿµŸàÿ™ ÿ≠ÿßŸÑŸä
                
                // ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑŸÜŸàÿπ
                currentSound = emergencySounds[type];
                if (!currentSound) {
                    console.error('ŸÜŸàÿπ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ:', type);
                    return;
                }

                // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™
                const playSound = () => {
                    if (currentSound) {
                        currentSound.currentTime = 0; // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿµŸàÿ™ ŸÑŸÑÿ®ÿØÿßŸäÿ©
                        const playPromise = currentSound.play();
                        
                        if (playPromise !== undefined) {
                            playPromise.catch(error => {
                                console.error('ŸÅÿ¥ŸÑ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™:', error);
                            });
                        }
                    }
                };

                // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™ ŸÖÿ®ÿßÿ¥ÿ±ÿ©
                playSound();

                // ÿ™ŸÉÿ±ÿßÿ± ÿßŸÑÿµŸàÿ™ ŸÉŸÑ 10 ÿ´ŸàÿßŸÜŸä
                if (audioInterval) {
                    clearInterval(audioInterval);
                }
                audioInterval = setInterval(playSound, 10000);
            }

            function stopSpeaking() {
                // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿµŸàÿ™ ÿßŸÑÿ≠ÿßŸÑŸä
                if (currentSound) {
                    currentSound.pause();
                    currentSound.currentTime = 0;
                }

                // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
                if (audioInterval) {
                    clearInterval(audioInterval);
                    audioInterval = null;
                }
            }

            // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ŸÉŸÑ 5 ÿ´ŸàÿßŸÜŸä
            setInterval(() => {
                const directions = ['north', 'south', 'east', 'west'];
                directions.forEach(direction => {
                    const count = Math.floor(Math.random() * 50) + 10; // ÿπÿØÿØ ÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ®ŸäŸÜ 10 Ÿà 60
                    updateCongestionLevel(direction, count);
                });
            }, 5000);

            // ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ
            function updateCongestionLevel(direction, count) {
                const statusElement = document.getElementById(`${direction}-status`);
                const congestionElement = document.getElementById(`${direction}-congestion`);
                const card = statusElement.closest('.congestion-card');
                const indicator = card.querySelector('.status-indicator');
                
                let level = 'ŸÖŸÜÿÆŸÅÿ∂';
                let levelClass = 'level-low';
                let trafficLevel = 'low';
                
                if (count > 40) {
                    level = 'ŸÖÿ±ÿ™ŸÅÿπ';
                    levelClass = 'level-high';
                    trafficLevel = 'high';
                } else if (count > 30) {
                    level = 'ŸÖÿ™Ÿàÿ≥ÿ∑';
                    levelClass = 'level-medium';
                    trafficLevel = 'medium';
                } else {
                    congestionLevels[direction] = 'low';
                }
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµ ŸàÿßŸÑŸÖÿ§ÿ¥ÿ±
                statusElement.textContent = level;
                congestionElement.textContent = count + ' ÿ≥Ÿäÿßÿ±ÿ©';
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàŸÜ ÿßŸÑŸÖÿ§ÿ¥ÿ±
                indicator.className = 'status-indicator ' + levelClass;

                // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
                updateTrafficLightByLevel(direction, trafficLevel);
            }

            function updateTrafficLightByLevel(direction, level) {
                // ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿØÿßŸÑÿ© ŸÑŸÑÿ≥ŸÖÿßÿ≠ ÿ®ÿßŸÑÿπŸÖŸÑ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ŸÑŸÑÿ∑ÿ±ŸÇ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ™ÿ£ÿ´ÿ±ÿ©
                if (emergencyMode && (direction === emergencyStats.direction || emergencyStats.affectedRoads.includes(direction))) return;

                const redLight = document.getElementById(`${direction}-red`);
                const yellowLight = document.getElementById(`${direction}-yellow`);
                const greenLight = document.getElementById(`${direction}-green`);
                
                if (redLight && yellowLight && greenLight) {
                    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸÑŸàÿßŸÜ
                    redLight.style.fill = '#333';
                    yellowLight.style.fill = '#333';
                    greenLight.style.fill = '#333';
                    
                    // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸàŸÖŸäÿ∂
                    redLight.style.animation = '';
                    yellowLight.style.animation = '';
                    greenLight.style.animation = '';

                    // ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÑŸàŸÜ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ
                    switch (level) {
                        case 'low':
                            // ÿ£ÿÆÿ∂ÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑŸÖŸÜÿÆŸÅÿ∂
                            greenLight.style.fill = 'green';
                            break;
                        case 'medium':
                            // ÿ£ÿµŸÅÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑
                            yellowLight.style.fill = 'yellow';
                            break;
                        case 'high':
                            // ÿ£ÿ≠ŸÖÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑŸÖÿ±ÿ™ŸÅÿπ
                            redLight.style.fill = 'red';
                            break;
                    }
                }
            }

            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
            window.addEventListener('load', () => {
                updateStats();
                resetTrafficLights();
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿßÿ≤ÿØÿ≠ÿßŸÖ ÿßŸÑÿ£ŸàŸÑŸäÿ©
                const directions = ['north', 'south', 'east', 'west'];
                directions.forEach(direction => {
                    const count = Math.floor(Math.random() * 50) + 10;
                    updateCongestionLevel(direction, count);
                });
            });

            // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÜŸÖÿßÿ∑ CSS ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ±
            document.addEventListener('DOMContentLoaded', function() {
                const panel = document.querySelector('.control-panel');
                const toggleButton = document.querySelector('.toggle-panel');
                
                // ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ŸàŸÑŸäÿ©
                panel.style.top = '-100%';
                toggleButton.style.display = 'block';
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿ£ŸÜŸÖÿßÿ∑ ŸÑŸÑÿ≤ÿ±
                toggleButton.style.position = 'fixed';
                toggleButton.style.top = '20px';
                toggleButton.style.right = '20px';
                toggleButton.style.zIndex = '999';
                toggleButton.style.padding = '10px 20px';
                toggleButton.style.color = 'white';
                toggleButton.style.border = 'none';
                toggleButton.style.borderRadius = '5px';
                toggleButton.style.cursor = 'pointer';
                toggleButton.style.fontWeight = 'bold';
            });

            // ÿ•ÿ∂ÿßŸÅÿ© ÿØÿßŸÑÿ© togglePanel
            function togglePanel() {
                const panel = document.querySelector('.control-panel');
                if (panel.style.top === '0px') {
                    panel.style.top = '-100%';
                } else {
                    panel.style.top = '0px';
                }
            }
        </script>
    </body>
</html>
